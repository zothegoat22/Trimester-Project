<p id='level'></p>

<canvas id="Canvas" width="800" height="800"></canvas>

<script>

    var c = document.getElementById("Canvas");
    var context = c.getContext("2d");
    var deaths=0;
    var numcoins=0; 
    var speed=1.2;  
    var size=25;
    var level=1;
    var rightMovement=0;
    var leftMovement=0;
    var upMovement=0;
    var downMovement=0;   
    document.addEventListener("keydown", movement, false);
    document.addEventListener("keyup", stayStill, false);

    function skip(lvl) {
        level=lvl;
        numcoins=0;
        player['x']=spawnpoints[level][0];
        player['y']=spawnpoints[level][1];
    }

    function addblock(type,x,y) {
        blocks[blockLevel].push({'type':type,'x':x,'y':y});
    }

    function addblocks(type,x1,y1,x2,y2) {
        var i=x1*1;

        while (x2+1>i) {
            var j=y1*1;

            while (y2+1>j) {
                addblock(type,i,j);
                j++;
            }

            i++;
        }
    }

    var blocks=[[],[],[],[],[],[],[]];

    var blockLevel = 3
    addblocks(1,0,0,14,0);
    addblocks(1,0,1,0,9);
    addblocks(1,1,9,18,9);
    addblocks(1,15,0,23,0);
    addblocks(1,23,1,23,9);
    addblocks(1,19,9,22,9);
    addblocks(0,3,1,19,8);
    addblocks(2,1,1,3,8);
    addblocks(3,20,1,22,8);
    var blockLevel = 2;
    addblocks(1,0,2,4,2);
    addblocks(1,0,2,0,8);
    addblocks(1,0,8,4,8);
    addblocks(1,4,0,4,1);
    addblocks(1,4,0,20,0);
    addblocks(1,4,9,4,12);
    addblocks(1,4,12,20,12);
    addblocks(1,20,1,20,4);
    addblocks(1,20,8,20,12);

    addblocks(1,7,3,7,9);
    addblocks(1,7,3,17,3);
    addblocks(1,7,9,17,9);
    addblocks(1,17,3,17,9)


    addblocks(1,20,4,24,4);
    addblocks(1,20,8,24,8);
    addblocks(1,24,4,24,8);

    addblocks(0,5,1,17,2);
    addblocks(0,5,1,6,11);
    addblocks(0,5,10,17,11);
    addblocks(0,18,1,19,11);

    addblocks(2,1,3,4,7);
    addblocks(3,20,5,23,7);
    var blockLevel = 1
    addblocks(1,0,3,3,3);
    addblocks(1,0,3,0,12);
    addblocks(1,0,12,3,12);
   
    addblocks(0,1,4,3,11);
    addblocks(0,4,0,5,12);
    addblocks();
    addblocks();
    addblocks();
    addblocks();
    addblocks();
    addblocks();

    addblocks();
    addblocks();

    function addenemy(x,y,xv,yv,minx=0,maxx=100,miny=0,maxy=100) {
        enemies[levelE].push({'x':x,'y':y,'xv':xv/size,'yv':yv/size,'minx':minx,'maxx':maxx,'miny':miny,'maxy':maxy});
    }

    var enemies = [[],[],[],[],[],[],[],[]];
    var levelE = 3;
    addenemy(4,1,0,-1.8);
    addenemy(5,8,0,1.8);
    addenemy(6,1,0,-1.8);
    addenemy(7,8,0,1.8);
    addenemy(8,1,0,-1.8);
    addenemy(9,8,0,1.8);
    addenemy(10,1,0,-1.8);
    addenemy(11,8,0,1.8);
    addenemy(12,1,0,-1.8);
    addenemy(13,8,0,1.8);
    addenemy(14,1,0,-1.8);
    addenemy(15,8,0,1.8);
    addenemy(16,1,0,-1.8);
    addenemy(17,8,0,1.8);
    addenemy(18,1,0,-1.8);
    addenemy(19,8,0,1.8);
    var levelE = 2;
    addenemy(5,1,0,2.5);
    addenemy(6,11,0,-2.5);

    addenemy(18,1,0,2.5)
    addenemy(19,11,0,-2.5)

    addenemy(7,1,0,.3);
    addenemy(9,2,0,-.3);
    addenemy(11,1,0,.3);
    addenemy(13,2,0,-.3);
    addenemy(15,1,0,.3);
    addenemy(17,2,0,-.3);
    addenemy(7,10,0,.3);
    addenemy(9,11,0,-.3);
    addenemy(11,10,0,.3);
    addenemy(13,11,0,-.3);
    addenemy(15,10,0,.3);
    addenemy(17,11,0,-.3);

    var levelE = 1;

    function movement(xMove) {
        if(xMove.keyCode == 68){
            rightMovement=1;
        }

        else if(xMove.keyCode == 65){
            leftMovement=1;
        } 

        else if(xMove.keyCode == 87){
            upMovement=1;
        } 
        else if(xMove.keyCode == 83){
            downMovement=1;
        }
    }

    function stayStill(xStill) {
        if(xStill.keyCode == 68) {
            rightMovement=0;
        } 
        else if(xStill.keyCode == 65) {
            leftMovement=0;
        } 
        else if(xStill.keyCode == 87) {
            upMovement=0;
        } 
        else if(xStill.keyCode == 83) {
            downMovement=0;
        }
    }

    function movePlayer() {
        var oldx=player['x'];
        var oldy=player['y'];
        if (rightMovement==1){
            player['x']+=speed;
        }
        if (leftMovement==1){
            player['x']-=speed;
        }

        collide(oldx,oldy);
        var oldx=player['x'];
        var oldy=player['y'];
        if (upMovement==1){
            player['y']-=speed;
        }
        if (downMovement==1){
            player['y']+=speed;
        }
        collide(oldx,oldy)
    }

    function moveEnemies() {
        var i=0
        while (enemies[level].length>i) {
            enemies[level][i]['x']+=enemies[level][i]['xv'];

            if (collideEnemy(enemies[level][i])) {
                enemies[level][i]['xv']=0-enemies[level][i]['xv'];
            }
            if (enemies[level][i]['minx']>=enemies[level][i]['x']) {
                enemies[level][i]['xv']=Math.abs(enemies[level][i]['xv']);
            }
            if (enemies[level][i]['x']>=enemies[level][i]['maxx']) {
                enemies[level][i]['xv']=0-Math.abs(enemies[level][i]['xv']);
            }

            enemies[level][i]['y']+=enemies[level][i]['yv'];

            if (collideEnemy(enemies[level][i]) || enemies[level][i]['miny']>=enemies[level][i]['y'] || enemies[level][i]['y']>=enemies[level][i]['maxy']) {
                enemies[level][i]['yv']=0-enemies[level][i]['yv'];
            }
            i++
        }
    }

    function collide(x,y) {
        var i=0;
        var player_rect={x:player['x'],y:player['y'],width:size*0.6,height:size*0.6};

        while (blocks[level].length>i) {
            var block_rect={x:blocks[level][i]['x']*size,y:blocks[level][i]['y']*size,width:size,height:size};

                if (colliding(player_rect,block_rect) && blocks[level][i]['type']===1) {
                player['x']=x;
                player['y']=y;
            }

            if (colliding(player_rect,block_rect) && blocks[level][i]['type']===3) {
                level+=1;
                numcoins=0;
                player['x']=spawnpoints[level][0];
                player['y']=spawnpoints[level][1];
            }


            i++
        }

        i=0
        while (enemies[level].length>i) {
            enemy=enemies[level][i]
            var enemy_rect={x:enemy['x']*size+(size*0.2),y:enemy['y']*size+(size*0.2),width:size*0.6,height:size*0.6}

            if (colliding(player_rect,enemy_rect)) {
                player['x']=spawnpoints[level][0];
                player['y']=spawnpoints[level][1];
                deaths+=1;
                numcoins=0;
                j=0;

                while (coins[level].length>j) {
                    coins[level][j]['collected']=0;
                    j++;
                }

            }
        i++
        }

        i=0
        while (coins[level].length>i) {
            coin=coins[level][i]
            var coin_rect={x:coin['x']*size+(size*0.25),y:coin['y']*size+(size*0.25),width:size*0.5,height:size*0.5}

            if (colliding(player_rect,coin_rect) && coin['collected']===0) {
                coin['collected']=1
                numcoins+=1
            }

        i++
        }
    }

    function collideEnemy(enemy) {
        var i=0;
        var enemy_rect={x:enemy['x']*size,y:enemy['y']*size,width:size,height:size}
        while (blocks[level].length>i) {
            var block_rect={x:blocks[level][i]['x']*size,y:blocks[level][i]['y']*size,width:size,height:size}
            if (colliding(enemy_rect,block_rect) && (blocks[level][i]['type']===1 || blocks[level][i]['type']===4)) {
                return true;
            }
            i++;
        }
        return false;
    }

    function colliding(rect1,rect2) {
        if (rect1.x < rect2.x + rect2.width && rect1.x + rect1.width > rect2.x && rect1.y < rect2.y + rect2.height && rect1.y + rect1.height > rect2.y) {return true;
        }
       return false;
    }

    function draw() {
        document.getElementById('level').innerHTML='Level Num: '+level+' Num Deaths: '+deaths;
        context.fillStyle = "white";
        context.fillRect(0, 0, c.width, c.height);

        //GRID PATTERN
        var pos=0;
        while (blocks[level].length>pos) {
            var color='black';
            if (blocks[level][pos]['type']===0) {
                if (blocks[level][pos]['x']%2===0 && blocks[level][pos]['y']%2===0) {
                    color='white';
                }
                if (blocks[level][pos]['x']%2===0 && blocks[level][pos]['y']%2===1) {
                    color='lightgrey';
                }
                if (blocks[level][pos]['x']%2===1 && blocks[level][pos]['y']%2===0) {
                    color='lightgrey';
                }
                if (blocks[level][pos]['x']%2===1 && blocks[level][pos]['y']%2===1) {
                    color='white';
                }
            }
            if (blocks[level][pos]['type']===1) {
                color='grey';
            }
            if (blocks[level][pos]['type']===2) {
                color='yellow';
            }
            if (blocks[level][pos]['type']===3) {
                color='lightgreen';
             }
            context.fillStyle = color+""
            if (!(blocks[level][pos]['type']===4)) {
                context.fillRect(blocks[level][pos]['x']*size, blocks[level][pos]['y']*size, size, size);
            }
            pos++;
        }
        context.fillStyle = "purple";
        context.fillRect(player['x'], player['y'], size*0.6, size*0.6);
        context.strokeStyle="black";
        context.strokeRect(player['x'], player['y'], size*0.6, size*0.6);
        var i=0;

        while (enemies[level].length>i) {
            context.beginPath();
            context.arc(enemies[level][i]['x']*size+size/2,enemies[level][i]['y']*size+size/2,(size*0.6)/2,0,2*Math.PI);
            context.fillStyle = 'red';
            context.strokeStyle = 'black';
            context.fill();
            context.stroke();
            context.closePath();
            i++;
        }
        var i=0;

    }

    var spawnpoints = [[0,0],[size*2,size*6],[size*2,size*4],[size*1.5,size*2.5],[0,0]];
    var coinsneeded = [0,0,1,1];
    var player = {'x':spawnpoints[level][0],'y':spawnpoints[level][1]};
  
    function addcoin(x,y) {
        coins[coinlevel].push({'x':x,'y':y,'collected':0});
    }

    var coins = [[],[],[],[],[],[],[]];


    function doStuff() {
        draw();
        movePlayer();
        moveEnemies();
    }

    setInterval(doStuff,10);
    </script>
